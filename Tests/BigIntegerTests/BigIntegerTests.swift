import XCTest
@testable import BigInteger

final class BigIntegerTests: XCTestCase {
    func testPublicInitFromStr() {
        let a = BigInteger(from:
                "0000000000000000000000000000000000000612361193061935861237")
        XCTAssertEqual(a.mag, [1125502453, 842529961, 33])
        XCTAssertEqual(a.signum, true)

        let b = BigInteger(from: "-0006123611930619358612362")
        XCTAssertEqual(b.mag, [2665089930, 4130332316, 331])
        XCTAssertEqual(b.signum, false)

        let c = BigInteger(from: "0")
        XCTAssertEqual(c.mag, [0])
        XCTAssertEqual(c.signum, true)
    }

    func testAddMagT1() {
        let a = BigInteger(from: "612361193061935861237")
        let b = BigInteger(from: "61935861237")
        //c_mag = [3138768373, 3505532565, 28376639]
        let c = BigInteger(from: "523456612361193061935861237")
        //d_mag = [1946157056, 1340620830, 27105054]
        let d = BigInteger(from: "500000000000000000000000000")
        XCTAssertEqual(BigInteger.add(mag1: a.mag, mag2: b.mag),
                       [2931821546, 842529975, 33])
        XCTAssertEqual(BigInteger.add(mag1: c.mag, mag2: c.mag),
                       [1982569450, 2716097835, 56753279])
        XCTAssertEqual(BigInteger.add(mag1: d.mag, mag2: d.mag),
                       [3892314112, 2681241660, 54210108])

    }

    func testSubtractMagT1() {
        let a = BigInteger(from: "612361193061935861237")
        let b = BigInteger(from: "61935861237")
        let c = BigInteger(from: "523456612361193061935861237")
        let d = BigInteger(from: "500000000000000000000000000")
        XCTAssertEqual(BigInteger.subtract(mag1: a.mag, mag2: b.mag),
                       [3614150656, 842529946, 33])
        XCTAssertEqual(BigInteger.subtract(mag1: c.mag, mag2: d.mag),
                       [1192611317, 2164911735, 1271585])
        XCTAssertEqual(BigInteger.subtract(mag1: d.mag, mag2: d.mag), [0])

    }

    func testMulMagT1() {
        let a = BigInteger(from: "612361193061935861237")
        let b = BigInteger(from: "61935861237")
        let c = BigInteger(from: "523456612361193061935861237")
        let d = BigInteger(from: "500000000000000000000000000")

        XCTAssertEqual(BigInteger.multiply(mag1: a.mag, mag2: b.mag),
                       [2443410553, 2573930479, 3038812614, 478])
        XCTAssertEqual(BigInteger.multiply(mag1: c.mag, mag2: d.mag),
            [67108864, 2044281865, 1819053428, 197960665, 3325078967, 179081])
        XCTAssertEqual(BigInteger.multiply(mag1: c.mag, mag2: [0]), [0])
    }

    func testDivMagT1() {
        let a = BigInteger(from: "612361193061935861237")
        let b = BigInteger(from: "61935861237")
        let c = BigInteger(from: "523456612361193061935861237")
        let d = BigInteger(from: "500000000000000000000000000")

        //hack, should be fixed in division(mag1:_, mag2:_) v1.1b1
        let e = BigInteger(from: "612361193061935861237324234354353452352542352435435252435453")
        let f = BigInteger(from: "1000000000000000000")

        XCTAssertEqual(BigInteger.divide(mag1: e.mag, mag2: f.mag).0, [4274521118, 267499566, 3951190577, 2438715792, 1799, 0])
        XCTAssertEqual(BigInteger.divide(mag1: a.mag, mag2: b.mag).0, [1297086930, 2])
        XCTAssertEqual(BigInteger.divide(mag1: a.mag, mag2: b.mag).1, [2341514747, 6])
        XCTAssertEqual(BigInteger.divide(mag1: c.mag, mag2: d.mag).0, [1])
        XCTAssertEqual(BigInteger.divide(mag1: c.mag, mag2: d.mag).1, [1192611317, 2164911735, 1271585])
    }

    func testStringConvertible() {
        let a = BigInteger(from: "612361193061935861237")
        XCTAssertEqual(String(a), "612361193061935861237")
        let b = BigInteger(from: "-612361193061935861237324234354353452352542352435435252435453")
        XCTAssertEqual(String(b), "-612361193061935861237324234354353452352542352435435252435453")
        XCTAssertEqual(String(BigInteger(from: "0")), "0")
    }

    func testAddT1() {
        let a = BigInteger(from: "0000000000000000000000000000000000000612361193061935861237")
        let b = BigInteger(from: "-6123611930619358612362")
        let c = BigInteger(from: "-612361193061935861237")
        let d = BigInteger(from: "6123611930619358612362")

        XCTAssertEqual((a + a).mag, BigInteger(from: "1224722386123871722474").mag)
        XCTAssertEqual((a + a).signum, BigInteger(from: "1224722386123871722474").signum)

        XCTAssertEqual(String(a + b), "-5511250737557422751125")
        XCTAssertEqual(String(c + d), "5511250737557422751125")
    }

    func testSubtractT1() {
        let a = BigInteger(from: "612361193061935861237")
        let b = BigInteger(from: "-6123611930619358612362")
        let c = BigInteger(from: "-612361193061935861237")
        let d = BigInteger(from: "6123611930619358612362")

        XCTAssertEqual(String(a - a), "0")
        XCTAssertEqual(String(a - b), "6735973123681294473599")

        XCTAssertEqual(String(c - c), "0")
        XCTAssertEqual(String(c - d), "-6735973123681294473599")
    }

    func testMultiplyT1() {
        let a = BigInteger(from: "612361193061935861237")
        let b = BigInteger(from: "-6123611930619358612362")
        XCTAssertEqual(String(a * b), "-3749862307682374847564897134347193704811794")
        XCTAssertEqual(String(a * a), "374986230768237484756979602389168919170169")
        XCTAssertEqual(String(a * BigInteger(from: "0")), "0")
    }

    func testDivideT1() {
        let a = BigInteger(from: "-612361193061935861237")
        let b = BigInteger(from: "6123611930619358612362")
        XCTAssertEqual(String(a / a), "1")
        XCTAssertEqual(String(a / b), "0")
        XCTAssertEqual(String(b / a), "-9")
    }
    
    let bigNumA = "60521672074906160092921129976533027916807972783288640690417517816323220969834677638088012840834215147852015491066068785490695509945563119621542383371687687587225054942847812793632810372290857363109752157283959917798432949276506089500816279585198822958945204550238038699462191979562919100381119056819287327183319045527793484616425268318449026955106478454087806965067655462497289279716425810047300331821098106605692769858359090344223065263590977571037876420142663259928763459253858797204268726244733746954690077322262591003726802018910321210530688819361327839958922169248840279348754073010682511751023628906873531052419458208048953549299823939005891112462676748198684599838146862974865400741025106480094940595498138333689113670992095866933736166392960018471607050779322549842524809375739086320971161461366968705753113341748603533403501465311872984004112262980449619185011810188767618852942255447378544698432986543773130934435981743060267819313324906821893837587889283491909180446083342020746509280882230787076566780947396943142582014432899687215224899065427788715214354252779842658399764655168669859264987013304912483275414963203716510653380542791259024526844379265179825164932533840391306674956308352462684651442092880605257649177047977275452078805769385113879439660871245912171196158502941483014311494137227539776283013323013363280217776672478476615694773398702510861477240238217853777548597612340510357926100511990883934590921959571840635138309866265864090928469194979178684077427504556306854872507441326107277207193699981445427855844585160567575169835129399405894992212500289569825899183047964695162713980241631206115790422969733398016825233764492423871192656719320603510243762524981914263061684198769067845733008802042552524065352236336406016005508695701644730041982738519799411235750292083709184583232312871001277452083264654413809303254016592172931072667555889324385652020432690830768801466131892935769193081427520079744467783144730996290338862274003979027355905065795406718968537598324681403200486883656731957520694087374476852196895976845554"
    let bigNumB = "94071234580375063714710967742550969581383630403158064506131505784960851975142974440213813538503373139480592674015458400770121243511380941416181183685765481285567851133418939803546815351776236255137619684715062660868753305990883655804483706051280230932669086063985744576979198780046189260878099579770122551287913392104960744563209550684169531881520840660397052694482531502495977580810810936722277710257206143805784472137872450636636740417038072935515282206571837004268824542487696994821982255269773709164948476016312922807040806891523212258625244294142578011003548205569651892661802114373295813403833927670300106199451985431614755524787989638718465792363413846834026218468653114669417317332471650378106051901266754829959429414996613753645282214596245590520815699859568022000145942930863054841828002165714116006253750660677573260480966339451684426126000354390506744145620882541347932258920251757128161907372976668807861061323230254111403472387861866277727995602215322659423197600820542125822556594277559553074975868684809901362560990408511586171893843603468356356481444619696697001187645247336348573058662915479789280320394891477672621015514072472102454539706969894927303404745773275775882899460995799495843550190946607966830315981614589608368483468230660260545487534908530896715003963674789183951812441165659830468987970396002654244304309403917178593376217964176894977910921250298927060874163279629846437528803996289602361583994904130865348506315677199510893879176870192055580010734708641644345085615783719132956765797531244943955042391085869641708107536811256757889609124709435400297910326674590976729766473833774899773241239554645129490157952278220813299279215091733353491108118155723131301739018411304090507576278206087268640304860774694667442601908581033007821756302554630112324472941369699511956905386492858996543290479390840493926675928203460437744590702628300500136580316929326338159294592728803928148450075617362946192147363633503446843322010083050381792589174851060948646435035006967581837560517909786136546307915063422254170504536959957700"
    
    func testAddT2() {
        let a = BigInteger(from: bigNumA)
        let b = BigInteger(from: bigNumB)
        let minusB = BigInteger(from: "-" + bigNumB)

        XCTAssertEqual(String(a + b), "154592906655281223807632097719083997498191603186446705196549023601284072944977652078301826379337588287332608165081527186260816753456944061037723567057453168872792906076266752597179625724067093618247371841999022578667186255267389745305299985636479053891614290614223783276441390759609108361259218636589409878471232437632754229179634819002618558836627319114484859659550186964993266860527236746769578042078304250411477241996231540980859805680629050506553158626714500264197588001741555792026250981514507456119638553338575513810767608910433533469155933113503905850962470374818492172010556187383978325154857556577173637251871443639663709074087813577724356904826090595032710818306799977644282718073496756858200992496764893163648543085988709620579018380989205608992422750638890571842670752306602141162799163627081084712006864002426176793884467804763557410130112617370956363330632692730115551111862507204506706605805963212580991995759211997171671291701186773099621833190104606151332378046903884146569065875159790340151542649632206844505143004841411273387118742668896145071695798872476539659587409902505018432323649928784701763595809854681389131668894615263361479066551349160107128569678307116167189574417304151958528201633039488572087965158662566883820562274000045374424927195779776808886200122177730666966123935302887370245270983719016017524522086076395655209070991362879405839388161488516780838422760891970356795454904508280486296174916863702705983644625543465374984807646065171234264088162213197951199958123225045240233972991231226389382898235671030209283277371940656163784601337209724970123809509722555671892480454075406105889031662524378527506983186042713237170471871811053957001351880680705045564800702610073158353309287008129821164370213011031073458607417276734652551798285293149911735708691661783221141488618805729997820742562655494907735979182220052610675663370184189824522232337362017168928096058860696863917643157044883025936615146778234443133660872357054360819945079916856355365403572605292263240761004793442868503828609150796731022701432936803254")
        XCTAssertEqual(String(a + minusB), "-33549562505468903621789837766017941664575657619869423815713987968637631005308296802125800697669157991628577182949389615279425733565817821794638800314077793698342796190571127009914004979485378892027867527431102743070320356714377566303667426466081407973723881513747705877517006800483270160496980522950835224104594346577167259946784282365720504926414362206309245729414876039998688301094385126674977378436108037200091702279513360292413675153447095364477405786429173744340061083233838197617713529025039962210258398694050331803314004872612891048094555474781250171044626036320811613313048041362613301652810298763426575147032527223565801975488165699712574679900737098635341618630506251694551916591446543898011111305768616496270315744004517886711546048203285572049208649080245472157621133555123968520856840704347147300500637318928969727077464874139811442121888091410057124960609072352580313405977996309749617208939990125034730126887248511051135653074536959455834158014326039167514017154737200105076047313395328765998409087737412958219978975975611898956668944538040567641267090366916854342787880592167678713793675902174876797044979928273956110362133529680843430012862590629747478239813239435384576224504687447033158898748853727361572666804566612332916404662461275146666047874037284984543807805171847700937500947028432290692704957072989290964086532731438701977681444565474384116433681012081073283325565667289336079602703484298718426993072944559024713368005810933646802950707675212876895933307204085337490213108342393025679558603831263498527186546500709074132937701681857351994616912209145830472011143626626281567052493592143693657450816584911731473332718513728389428086558372412749980864355630741217038677334212535022661843269404044716116239508538358261426596399885331363091714319816110312913237191077615802772322154179987995265838396126186080117372674186868264813518035072411175750928296496635507390493126596910992379256994189842866447679580488772450552983147809046402765233269785265541927466497408642900434360031026129404588787220976047777318307640983112146")
    }
}
